<!DOCTYPE html>
<html>
	<head>
		<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
		
		<style>
			div {
			    position: fixed;
			    width: 498px;
			    border: 1px solid black;
				margin-left: auto;
				margin-right: auto;
				right: 0;
				left: 0;
				margin-top: -50px;
			}
			canvas#myCanvas {
				background-color: rgb(255, 255, 255);
				box-shadow: 5px 5px 33px -5px grey;
				margin: 2% auto auto auto;
				display: block;

			}
		</style>
		<script>
			$(document).ready(function(){
				var c = document.getElementById('myCanvas');
				var ctx = c.getContext('2d');
				var b = document.getElementById('myCanvas');
				var ctx = c.getContext('2d');
				var $c = $('#myCanvas');
				var myPos = [50,435];
				var status = 'landed';
				var jump;
				var rotate = 0;
				var blocks = [300,435];
				var safe = false;

				/*
				ctx.fillStyle = "#FF0000";
				ctx.fillRect(50,435,60,15);

				ctx.fillStyle = "grey"        
				ctx.fillRect(160,420,60,30);

				ctx.moveTo(0,450);
				ctx.lineTo(500,450);
				ctx.stroke();

				ctx.beginPath();
				ctx.arc(440,60,50,0,2*Math.PI);
				ctx.stroke();

				ctx.font = "30px Arial";
				ctx.strokeText('Imposibru Game',5,30);
				*/
				drawME = function(color){
					ctx.fillStyle = color;
					ctx.fillRect(myPos[0],myPos[1],60,15);
				};

				/*
				ctx.moveTo(0,451);
				ctx.lineTo(500,451);
				ctx.stroke();


				ctx.fillStyle = 'red';
				ctx.fillRect(50,435,60,15);
				ctx.save();
				ctx.translate(50,435);
				ctx.translate(30,7.5);
				ctx.rotate(-0.5);
				ctx.fillStyle = 'pink';
				ctx.fillRect(-30,-7.5,60,15);
				ctx.restore();
				*/

				//drawME(50,435,"red")
				drawME('red');
				//ctx.moveTo(0,451);
				//ctx.lineTo(500,451);
				//ctx.stroke();

				$(document).keydown(function(key){
					console.log(key.keyCode);
					if(key.keyCode===32){
						if((status === 'landed' || safe)&& status !== 'dead') {
							status = 'jumped';
							rotate = 0;
							clearInterval(jump);
							clear(myPos);
							jump = setInterval(function(){
								
								ctx.save();
								myPos[1] -= 2.5;
								ctx.translate(myPos[0],myPos[1]);
								ctx.translate(30,7.5);
								rotate += (360/110)*(Math.PI/180);
								if (rotate > Math.PI*2.5/4){
									rotate = Math.PI*2.5/4;
								} 
								ctx.rotate(rotate);
								ctx.fillStyle = 'red';
								ctx.fillRect(-30,-7.5,60,15);
								ctx.restore();

								if (rotate === Math.PI*2.5/4){
									clearInterval(jump);
									status = 'jumped';
								}
								
								console.log(rotate);
								//console.log(myPos[0]+','+myPos[1]+": "+rotate)
							},1);
							
						}
					}
				});

				var clear = function(x){
					ctx.save();
					ctx.translate(x[0],x[1]);
					ctx.clearRect(-10,-30,90,90);
					ctx.restore();
				}

				var gravity = setInterval(function(){
								clear(myPos);

								if(myPos[1]<435 && myPos[0]+61<blocks[0]){
									//status = 'landing';
									ctx.save();
									if (rotate > Math.PI){
										rotate = Math.PI;
									} else if (rotate >= Math.PI*2.5/4){
										rotate += (360/110)*(Math.PI/180);
									}
									myPos[1] += 1;
									ctx.translate(myPos[0],myPos[1]);
									ctx.translate(30,7.5);
									ctx.rotate(rotate);
									ctx.fillStyle = 'red';
									ctx.fillRect(-30,-7.5,60,15);
									ctx.restore();


								} else if(myPos[1]+15 < blocks[1] && !safe){
									if (rotate > Math.PI){
										rotate = Math.PI;
									} else if (rotate >= Math.PI*2.5/4){
										rotate += (360/110)*(Math.PI/180);
									}
									
									if(myPos[1]+16 < blocks[1]){
										myPos[1] += 1;
									} else if (myPos[0]<blocks[0]+61){
										//rotate = Math.PI;
										myPos[1]=blocks[1]-16;
										safe = true;
									} else {
										//safe = true;
										//status = 'landed';
										//myPos[1] += 1;
									}
									ctx.save();
									ctx.translate(myPos[0],myPos[1]);
									ctx.translate(30,7.5);
									ctx.rotate(rotate);
									ctx.fillStyle = 'red';
									ctx.fillRect(-30,-7.5,60,15);
									ctx.restore();
								} else if(myPos[0]+61>=blocks[0] && !safe){
									
									clearInterval(gravity);
									clearInterval(moving);
									clearInterval(jump);
									status = 'dead';
									ctx.save();
									
									ctx.fillStyle = 'red';
									ctx.fillRect(myPos[0],myPos[1],60,15);
									ctx.restore();
									ctx.fillStyle = 'black';
									ctx.fillRect(blocks[0],blocks[1],60,15);
									

								} else if (safe&&myPos[0]>blocks[0]+60&&myPos[1]<435){
									ctx.save();

									
									if (rotate > Math.PI){
										rotate = Math.PI;
									} else if (rotate >= Math.PI*2.5/4){
										rotate += (360/110)*(Math.PI/180);
									} 
									
									myPos[1] += 1;
									ctx.translate(myPos[0],myPos[1]);
									ctx.translate(30,7.5);
									ctx.rotate(rotate);
									ctx.fillStyle = 'red';
									ctx.fillRect(-30,-7.5,60,15);
									ctx.restore();

								} else {
									status = 'landed';
									//myPos[1] += 1;
									//if (myPos[1]>435){
									//	myPos[1]=435;
									//}
									drawME('red');
								}
								console.log(status)
							},1)
				
				
				
				var moving = setInterval(function(){
					ctx.save();
					ctx.fillStyle = 'white';
					ctx.fillRect(blocks[0],blocks[1],60,15);
					ctx.restore();

					
					
					blocks[0] -= 1;

					if(blocks[0]===-60){

						blocks[0]=500;
						safe = false;
					}

					ctx.fillStyle = 'black';
					ctx.fillRect(blocks[0],blocks[1],60,15);

				},1);
				

			});
		</script>
	</head>
	<body>
		<canvas id='myCanvas' width='500' height='500'>
		</canvas>
		<div></div>
	</body>
</html>